<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>1-Simple Examples - World of Z2O-K7E</title>


        <!-- Custom HTML head -->
        <meta property="og:title" content="halo2/tmp/1-Simple-Example.md" />
        <meta name="description" content="é›¶çŸ¥ä¸–ç•Œ, Halo2 Tutorial, world of Zero-knowledge proof, Halo2 æ•™ç¨‹">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././mdbook-admonish.css">
        <link rel="stylesheet" href="../../theme/css/mdbook-admonish.css">
        <link rel="stylesheet" href="../../theme/css/open-in.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../index.html">ğŸŒŸ About z2o-k7e  /zu:Ëˆki:/</a></li><li class="chapter-item affix "><a href="../../vision.html">ğŸš© Our Vision & Roadmap</a></li><li class="chapter-item affix "><a href="../../how-to-contribute.html">ğŸ“– How-to-contribute</a></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><a href="../../beginner.html">ZKP æ–°æ‰‹æ‘å…¥é—¨æ”»ç•¥</a></li><li class="chapter-item affix "><a href="../../zk-everything/zk-everything-Jade/Hello_ZKP.html">Hello ZKP</a></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item "><a href="../../zkp-intro/toc.html">æ¢ç´¢é›¶çŸ¥è¯†è¯æ˜ç³»åˆ—</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../zkp-intro/1/zkp-back.html">ï¼ˆä¸€ï¼‰åˆè¯†ã€Œé›¶çŸ¥è¯†ã€ä¸ã€Œè¯æ˜ã€</a></li><li class="chapter-item "><a href="../../zkp-intro/2/zkp-simu.html">ï¼ˆäºŒï¼‰ç†è§£ã€Œæ¨¡æ‹Ÿã€</a></li><li class="chapter-item "><a href="../../zkp-intro/3/zkp-pok.html">ï¼ˆä¸‰ï¼‰å¯»æ‰¾ã€ŒçŸ¥è¯†ã€</a></li><li class="chapter-item "><a href="../../zkp-intro/4/zkp-rom.html">ï¼ˆå››ï¼‰éšæœºã€ŒæŒ‘æˆ˜ã€</a></li><li class="chapter-item "><a href="../../zkp-intro/5/zkp-crs.html">ï¼ˆäº”ï¼‰åŸ‹è—ã€Œç§˜å¯†ã€</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="../../zk-snarks/toc.html">ä»é›¶å¼€å§‹å­¦ä¹  zk-SNARK</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../zk-snarks/1-Polynomial-Interaction-and-Proof.html">1-Polynomial-Interaction-and-Proof</a></li><li class="chapter-item "><a href="../../zk-snarks/2-Non-interactivity&Distributed-Setup.html">2-Non-interactivity&Distributed-Setup</a></li><li class="chapter-item "><a href="../../zk-snarks/3-General-Purpose-Computation.html">3-General-Purpose-Computation</a></li><li class="chapter-item "><a href="../../zk-snarks/4-Construction-Properties.html">4-Construction-Properties.md</a></li><li class="chapter-item "><a href="../../zk-snarks/5-Pinocchio-Protocol.html">5-Pinocchio-Protocol</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-intro.html">ç†è§£ Plonk ç³»åˆ—</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-arithmetization.html">1-Plonkish Arithmetization</a></li><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-lagrange-basis.html">2-å¤šé¡¹å¼ç¼–ç </a></li><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-permutation.html">3-ç½®æ¢è¯æ˜</a></li><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-constraints.html">4-ç®—æœ¯çº¦æŸä¸æ‹·è´çº¦æŸ</a></li><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-polycom.html">5-å¤šé¡¹å¼æ‰¿è¯º</a></li><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-randomizing.html">6-å®ç° Zero Knowledge</a></li><li class="chapter-item "><a href="../../plonk-intro-cn/plonk-lookup.html">7-Lookup Gate</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="../../lasso-zh/lasso-intro.html">ç†è§£ Lasso ç³»åˆ—</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../lasso-zh/lasso-0.html">ç†è§£ Lassoï¼ˆé›¶ï¼‰ï¼šå¸¦ç´¢å¼•çš„æŸ¥è¯¢è¯æ˜</a></li><li class="chapter-item "><a href="../../lasso-zh/lasso-1.html">ç†è§£ Lassoï¼ˆä¸€ï¼‰ï¼šOffline Memory Checking</a></li><li class="chapter-item "><a href="../../lasso-zh/lasso-2.html">ç†è§£ Lasso (äºŒ)ï¼šç¨€ç–å‘é‡ä¸ Tensor ç»“æ„</a></li><li class="chapter-item "><a href="../../lasso-zh/lasso-3.html">ç†è§£ Lasso (ä¸‰)ï¼šå¤§è¡¨æ ¼çš„ç¨€ç–æŸ¥è¯¢è¯æ˜</a></li><li class="chapter-item "><a href="../../lasso-zh/lasso-4.html">ç†è§£ Lasso (å››)ï¼šæ›´å¤šçš„å¯åˆ†è§£è¡¨æ ¼</a></li><li class="chapter-item "><a href="../../lasso-zh/lasso-5.html">ç†è§£ Lasso (äº”)ï¼šè¡¨æ ¼çš„ MLE ç»“æ„</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item expanded "><a href="../../halo2/halo2.html">Halo2 Tutorial</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../halo2/chap-0/index.html">1-basic concepts</a></li><li class="chapter-item "><a href="../../halo2/chap-1/index.html">2-simple-circuit</a></li><li class="chapter-item "><a href="../../halo2/chap-2/index.html">3-custom-gate</a></li><li class="chapter-item "><a href="../../halo2/chap-3/index.html">4-fibonacci</a></li><li class="chapter-item "><a href="../../halo2/chap-4/index.html">5-range-check</a></li><li class="chapter-item "><a href="../../halo2/cost-model.html">6-cost-model</a></li><li class="chapter-item "><a href="../../halo2/halo2-QA.html">halo2-QA</a></li><li class="chapter-item "><a href="../../halo2/tmp/halo2-learning-materials.html">halo2-learning-materials</a></li><li class="chapter-item expanded "><a href="../../halo2/tmp/halo2-learning-materials.html">learning-halo2 (0xPARC)</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../halo2/tmp/1-Simple-Example.html" class="active">1-Simple Examples</a></li><li class="chapter-item "><a href="../../halo2/tmp/2-Fibonacci-example-1.html">2-Fibonacci-example-1</a></li><li class="chapter-item "><a href="../../halo2/tmp/3-Fibonacci-example-2.html">3-Fibonacci-example-2</a></li><li class="chapter-item "><a href="../../halo2/tmp/4-IsZero-Check-example-3.html">4-IsZero Check-example-3</a></li><li class="chapter-item "><a href="../../halo2/tmp/5-Range-check.html">5-Range check-example-1.md</a></li><li class="chapter-item "><a href="../../halo2/tmp/6-Range-Check(code-explanation).html">6-Range Check (code explanation)</a></li><li class="chapter-item "><a href="../../halo2/tmp/7-Range-Check-lookup(example-2).html">7-Range Check-Lookup-example-2)</a></li><li class="chapter-item "><a href="../../halo2/tmp/8-Range-Check(example-3).html">8-Range Check-Lookup-example-3)</a></li><li class="chapter-item "><a href="../../halo2/tmp/9-decomposed.html">9-Range Check-Decompose)</a></li><li class="chapter-item "><a href="../../halo2/tmp/ZKP-APP.html">ZKP Apps with halo2</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../halo2/tmp/Zordle.html">Zordle</a></li><li class="chapter-item "><a href="../../halo2/tmp/Hammster.html">Hammster</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-Xor0v0/Lattice-1-Basic.html">Lattice-based Crypography</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../zk-everything/zk-everything-Xor0v0/Lattice-1-Basic.html">Lattice-1-Basic</a></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-Xor0v0/Lattice-2-LLL.html">Lattice-2-LLL</a></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-Xor0v0/Lattice-3-CVP.html">Lattice-3-CVP</a></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-Xor0v0/Lattice-4-RSA.html">Lattice-4-RSA</a></li></ol></li><li class="chapter-item "><a href="../../zkp-QA.html">Recurrent Q&A</a></li><li class="chapter-item "><a href="../../zk-everything/toc.html">zk-everything</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../zk-everything/BabySNARK tutorial.html">BabySNARK tutorial</a></li><li class="chapter-item "><a href="../../zk-everything/zk-learning-miles/KZG.html">KZG</a></li><li class="chapter-item "><a href="../../zk-everything/zk-learning-miles/Lecture1:Overview about Zeroknowledge.html">Lecture1:Overview about Zeroknowledge</a></li><li class="chapter-item "><a href="../../zk-everything/zk-learning-miles/Lecture2:Introduction to Modern SNARKs.html">Lecture2:Introduction to Modern SNARKs</a></li><li class="chapter-item "><a href="../../zk-everything/zk-learning-miles/Lecture12:ZKEVM.html">Lecture12:ZKEVM</a></li><li class="chapter-item "><a href="../../zk-everything/zk-learning-miles/Lecture16:Hardware acceleration.html">Lecture16:Hardware acceleration</a></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-joe/GKR_with_ZK_Argument.html">Spartan preliminary: GKR with ZK Argument</a></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-joe/Hyrax.html">Spartan preliminary: Hyrax</a></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-joe/Spartan.html">Spartan In Depth</a></li><li class="chapter-item "><a href="../../zk-everything/zk-everything-joe/Theory_and_Practical_Implementation_of_BLS12-381.html">BLS12-381 ç†è®ºä¸å®ç°</a></li><li class="chapter-item "><a href="../../Nova/SuperNova.html">SuperNova</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="../../public goods/toc.html">ZKP Public Goods</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../public goods/ç¬¬äºŒç« .html">ch2</a></li><li class="chapter-item "><a href="../../public goods/4-Proving-System.html">ch4-Proving System</a></li><li class="chapter-item "><a href="../../public goods/5-plonk-intro.html">ch5-plonk-intro</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="../../materials/ZK-Materials.html">ZK Materials</a></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item "><a href="../../exp/toc.html">ç»éªŒå¿ƒå¾—</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../exp/guoyu.html">éƒ­å®‡ï¼šZK æŠ€æœ¯çš„å­¦ä¹ å¿ƒå¾—å’Œç»éªŒåˆ†äº«</a></li><li class="chapter-item "><a href="../../exp/freeyao.html">å¯¹è¯å§šç¿”ï¼šè§£è¯»é›¶çŸ¥è¯†è¯æ˜çš„å‰ä¸–ä»Šç”Ÿ</a></li><li class="chapter-item "><a href="../../https://zhuanlan.zhihu.com/p/268305208.html">é‚“ç‡šï¼šé›¶çŸ¥è¯†ï¼Œæ¨¡æ‹Ÿä¸å½’çº¦ï¼ˆä¸€ä¸ªä¸ªäººåŒ–çš„è§†è§’ï¼‰</a></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item "><a href="../../zkp-space/toc.html">ZKP Space</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../zkp-space/2023-10-22-zkp-coprocessor.html">2023.10.12: èŠèŠ ZKP Coprocessor</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">World of Z2O-K7E</h1>

                    <div class="right-buttons">
                        <button id="lang-toggle" class="icon-button" type="button" title="Change Language" aria-label="Change Language" aria-haspopup="true" aria-expanded="false" aria-controls="lang-list">
                            <i class="fa fa-globe"></i>
                        </button>
                        <ul id="lang-list" class="theme-popup" style="left: auto;" aria-label="Languages" role="menu">
                            <li role="none"><button role="menuitem" class="theme"><a id="lang-cn">ä¸­æ–‡</a></button></li>
                            <li role="none"><button role="menuitem" class="theme"><a id="lang-en">English</a></button></li>
                        </ul>
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/zkp-co-learning/zkp-co-learning.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/zkp-co-learning/zkp-co-learning.github.io/edit/main/src/halo2/tmp/1-Simple-Example.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<blockquote>
<p>author: <a href="https://github.com/Demian101">@Demian</a></p>
<p>references: <a href="https://learn.0xparc.org/halo2/">https://learn.0xparc.org/halo2/</a></p>
</blockquote>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90">ç®€å•ä¾‹å­</a>
<ul>
<li><a href="#%E5%AE%9A%E4%B9%89-instructions">å®šä¹‰ instructions</a></li>
<li><a href="#%E5%AE%9A%E4%B9%89%E8%8A%AF%E7%89%87%E7%9A%84%E5%AE%9E%E7%8E%B0">å®šä¹‰èŠ¯ç‰‡çš„å®ç°</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E8%8A%AF%E7%89%87">é…ç½®èŠ¯ç‰‡</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0-chip-traits">å®ç° chip Traits</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E7%94%B5%E8%B7%AF">æ„å»ºç”µè·¯</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E7%94%B5%E8%B7%AF">æµ‹è¯•ç”µè·¯</a></li>
</ul>
</li>
<li><a href="#code-ref--full-example">Code Ref / Full example</a></li>
<li><a href="#references">References:</a></li>
<li><a href="#------%E4%B8%AD%E6%96%87%E7%89%88%E6%9C%AC-end-------">â€”â€“ ä¸­æ–‡ç‰ˆæœ¬ End â€”â€”</a></li>
<li><a href="#simple-example">Simple Example</a>
<ul>
<li><a href="#define-instructions">Define instructions</a></li>
<li><a href="#define-a-chip-implementation">Define a chip implementation</a></li>
<li><a href="#configure-the-chip">Configure the chip</a></li>
<li><a href="#implement-chip-traits">Implement chip Traits</a></li>
<li><a href="#build-the-circuit">Build the Circuit</a></li>
<li><a href="#testing-the-circuit">Testing the circuit</a></li>
</ul>
</li>
<li><a href="#code-ref--full-example-1">Code Ref / Full example</a></li>
<li><a href="#------%E9%97%AE%E9%A2%98-question------">â€”â€“ é—®é¢˜ Question â€”â€“</a></li>
</ul>
<h3 id="overview"><a class="header" href="#overview">Overview</a></h3>
<p><img src="imgs/1/Pastedimage20230912220538.png" alt="" /></p>
<p><img src="imgs/1/Pastedimage20230912162739.png" alt="" /></p>
<p><img src="./imgs/1/2023-08-25-050418.png" alt="" /></p>
<h3 id="ç®€å•ä¾‹å­"><a class="header" href="#ç®€å•ä¾‹å­">ç®€å•ä¾‹å­</a></h3>
<p>æˆ‘ä»¬å…ˆä»ä¸€ä¸ªç®€å•çš„ç”µè·¯å¼€å§‹ï¼Œä»‹ç»å¸¸ç”¨çš„ API ä»¥åŠå®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ã€‚ è¯¥ç”µè·¯å°†é‡‡ç”¨ public inputÂ <code>c</code>ï¼Œå¹¶å°†è¯æ˜ä¸¤ä¸ª private inputsÂ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>Â andÂ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> çš„çŸ¥è¯†ï¼Œä»¥ä½¿
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></span></p>
<h4 id="å®šä¹‰-instructions"><a class="header" href="#å®šä¹‰-instructions"><a href="https://zcash.github.io/halo2/user/simple-example.html#define-instructions">å®šä¹‰ instructions</a></a></h4>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬çš„ç”µè·¯æ‰€ä¾èµ–çš„æŒ‡ä»¤é›†(instructions)</p>
<p>Instructions ä»‹äº high-level gadgets å’Œåº•å±‚çš„ç”µè·¯æ“ä½œä¹‹é—´ã€‚æŒ‡ä»¤æ—¢å¯ä»¥ç»†ç²’åº¦ä¹Ÿå¯ä»¥ç²—ç²’åº¦ï¼Œä½†åœ¨å®è·µä¸­ï¼ŒæŒ‡ä»¤çš„åŠŸèƒ½åº”å½“è¶³å¤Ÿå°ï¼Œè¿™æ ·å¯ä»¥é‡å¤ä½¿ç”¨ï¼›ä½†åˆè¦è¶³å¤Ÿå¤§ï¼Œè¿™æ ·å¯ä»¥ä¼˜åŒ–å®ƒçš„å®ç°ã€‚è®¾è®¡è€…åº”å½“åœ¨è¿™ä¸¤è€…ä¹‹é—´å–å¾—å¹³è¡¡</p>
<p>å¯¹äºæˆ‘ä»¬çš„ç”µè·¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸‰ä¸ª instructionsï¼š</p>
<ul>
<li>å°† private number åŠ è½½åˆ°ç”µè·¯ä¸­ã€‚</li>
<li>ä¸¤ä¸ªæ•°å­—ç›¸ä¹˜ã€‚</li>
<li>å°†æ•°å­—å…¬å¼€(Expose) ä¸ºç”µè·¯çš„ public inputã€‚</li>
</ul>
<p>æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä»£è¡¨æ•°å­—çš„å˜é‡çš„ç±»å‹(<code>type Num</code>)ã€‚æŒ‡ä»¤æ¥å£(Instruction interfaces) ä¸ºå…¶è¾“å…¥å’Œè¾“å‡ºæä¾›å…³è”ç±»å‹(associated types)ï¼Œä»¥å…è®¸å®ç°ä»¥å¯¹å…¶ä¼˜åŒ–ç›®æ ‡æœ€æœ‰æ„ä¹‰çš„æ–¹å¼è¡¨ç¤ºè¿™äº›ç±»å‹ (to allow the implementations to represent these in a way that makes the most sense for their optimization goals.)</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait NumericInstructions&lt;F: Field&gt;: Chip&lt;F&gt; {
    /// Variable representing a number. ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ•°çš„å˜é‡
    type Num;

    /// Loads a number into the circuit as a private input. åŠ è½½éšç§è¾“å…¥
    fn load_private(&amp;self, layouter: impl Layouter&lt;F&gt;, a: Value&lt;F&gt;) -&gt; Result&lt;Self::Num, Error&gt;;

    /// Loads a number into the circuit as a fixed constant.
    fn load_constant(&amp;self, layouter: impl Layouter&lt;F&gt;, constant: F) -&gt; Result&lt;Self::Num, Error&gt;;

    /// Returns `c = a * b`.
    fn mul(
        &amp;self,
        layouter: impl Layouter&lt;F&gt;,
        a: Self::Num,
        b: Self::Num,
    ) -&gt; Result&lt;Self::Num, Error&gt;;

    /// Exposes a number as a public input to the circuit.
    /// å°†ä¸€ä¸ªæ•°ç½®ä¸ºç”µè·¯çš„å…¬å¼€è¾“å…¥
    fn expose_public(
        &amp;self,
        layouter: impl Layouter&lt;F&gt;,
        num: Self::Num,
        row: usize,
    ) -&gt; Result&lt;(), Error&gt;;
}
<span class="boring">}</span></code></pre></pre>
<p>Among them,</p>
<ul>
<li><em>Num</em> ç”¨äºé€‚é…æ­¤ interface ä¸­å¤„ç†çš„ç±»å‹</li>
<li><em>load_private</em> ç”¨äºåŠ è½½ witness</li>
<li><em>load_constant</em> ç”¨äºåŠ è½½å¸¸é‡ (constant)</li>
<li><em>mul</em> ç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°å­—çš„ä¹˜æ³•</li>
<li><em>expose_public</em> ç”¨äºè®¾ç½®å®ä¾‹ (instance)</li>
</ul>
<h4 id="å®šä¹‰èŠ¯ç‰‡çš„å®ç°"><a class="header" href="#å®šä¹‰èŠ¯ç‰‡çš„å®ç°"><a href="https://zcash.github.io/halo2/user/simple-example.html#define-a-chip-implementation">å®šä¹‰èŠ¯ç‰‡çš„å®ç°</a></a></h4>
<p>å¯¹äºæˆ‘ä»¬çš„ç”µè·¯ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª<a href="https://zcash.github.io/halo2/concepts/chips.html">èŠ¯ç‰‡(chip)</a>ï¼Œåœ¨æœ‰é™åŸŸä¸Šå®ç°æåˆ°çš„ Numeric Instruction (<code>trait NumericInstructions</code>)</p>
<blockquote>
<p>å¦‚æœæ‚¨æƒ³å¼€å‘è‡ªå®šä¹‰ chipï¼Œåˆ™éœ€è¦å»å®ç° Halo 2 çš„ <em>chip</em> Trait</p>
<p>å¤§å¤šæ•°æ—¶å€™ï¼Œä½¿ç”¨ Halo 2 è¿›è¡Œç”µè·¯å¼€å‘ä¸éœ€è¦è‡ªå·±å®šä¹‰ Instructions å’Œ chipã€‚ ä½†å¦‚æœä½ éœ€è¦ä½¿ç”¨ Halo 2 æ²¡æœ‰æä¾›çš„å¤æ‚ç®—æ³•ï¼Œå°±éœ€è¦è‡ªå·±å®ç°ï¼ˆä¾‹å¦‚å®ç°ä¸€ç§æ–°å…´çš„å¯†ç ç®—æ³•ï¼‰ã€‚</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// è¿™å—èŠ¯ç‰‡å°†å®ç°æˆ‘ä»¬çš„æŒ‡ä»¤é›† instructionsï¼
/// èŠ¯ç‰‡å­˜å‚¨å®ƒä»¬è‡ªå·±çš„é…ç½®ï¼Œä»¥åŠ(å¦‚æœ‰å¿…è¦çš„) ç±»å‹æ ‡è®°
struct FieldChip&lt;F: Field&gt; {
    config: FieldConfig,
    _marker: PhantomData&lt;F&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>æ¯ä¸€ä¸ªâ€œèŠ¯ç‰‡â€œç±»å‹<strong>éƒ½è¦å®ç° <code>Chip</code> trait</strong> , <code>Chip</code> trait å®šä¹‰äº† <code>Layouter</code> åœ¨ synthesizing ç”µè·¯æ—¶å¯èƒ½éœ€è¦çš„å…³äºç”µè·¯çš„æŸäº›å±æ€§ï¼Œä»¥åŠè‹¥å°†è¯¥èŠ¯ç‰‡åŠ è½½åˆ°ç”µè·¯æ‰€éœ€è¦è®¾ç½®çš„ä»»ä½•åˆå§‹çŠ¶æ€</p>
<blockquote>
<p>synthesizing ç”µè·¯ : ä¸€èˆ¬æŒ‡çš„æ˜¯ç±»ä¼¼ R1CS é‚£ç§å†™çº¦æŸçš„æ„æ€</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Every chip needs to implement theÂ `Chip`Â trait !!
impl&lt;F: FieldExt&gt; Chip&lt;F&gt; for FieldChip&lt;F&gt; {
    type Config = FieldConfig;
    type Loaded = ();

    fn config(&amp;self) -&gt; &amp;Self::Config {
        &amp;self.config
    }

    fn loaded(&amp;self) -&gt; &amp;Self::Loaded {
        &amp;()
    }
}
<span class="boring">}</span></code></pre></pre>
<h4 id="é…ç½®èŠ¯ç‰‡"><a class="header" href="#é…ç½®èŠ¯ç‰‡"><a href="https://zcash.github.io/halo2/user/simple-example.html#configure-the-chip">é…ç½®èŠ¯ç‰‡</a></a></h4>
<p>æ¥ä¸‹æ¥éœ€è¦ä¸ºèŠ¯ç‰‡ <code>chip</code> é…ç½®å¥½å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½æ‰€éœ€è¦çš„é‚£äº›åˆ—ã€ç½®æ¢ã€é—¨ï¼ˆcolumns, permutations, and gatesï¼‰ï¼š</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// èŠ¯ç‰‡ chip çš„çŠ¶æ€è¢«å­˜å‚¨åœ¨ä¸€ä¸ª FieldConfig ç»“æ„ä½“ä¸­ï¼Œå®ƒæ˜¯åœ¨é…ç½®è¿‡ç¨‹ä¸­ç”± chip ç”Ÿæˆï¼Œ
/// å¹¶ä¸”å­˜å‚¨åœ¨èŠ¯ç‰‡å†…éƒ¨ (type Config = FieldConfig;)
#[derive(Clone, Debug)]
struct FieldConfig {
    /// å¯¹äºè¿™å—èŠ¯ç‰‡ï¼Œæˆ‘ä»¬å°†ç”¨åˆ°ä¸¤ä¸ª advice åˆ—æ¥å®ç°æˆ‘ä»¬çš„æŒ‡ä»¤é›†ã€‚
    /// å®ƒä»¬ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ç”µè·¯å…¶ä»–éƒ¨åˆ†è¿›è¡Œé€šä¿¡çš„åˆ—ã€‚
    advice: [Column&lt;Advice&gt;; 2],
    instance: Column&lt;Instance&gt;, // public input åˆ—ï¼ˆinstanceï¼‰

    // æˆ‘ä»¬éœ€è¦ä¸€ä¸ª selector æ¥æ¿€æ´»ä¹˜æ³•é—¨ï¼Œåœ¨ç”¨ä¸åˆ° `NumericInstructions::mul`æŒ‡ä»¤çš„ cells
    // ä¸Šä¸è®¾ç½®ä»»ä½•çº¦æŸã€‚è¿™éå¸¸é‡è¦ï¼Œå°¤å…¶åœ¨æ„å»ºæ›´å¤§å‹çš„ç”µè·¯çš„æƒ…å†µä¸‹ï¼Œåˆ—ä¼šè¢«å¤šæ¡æŒ‡ä»¤é›†ç”¨åˆ°
    s_mul: Selector,
}
<span class="boring">}</span></code></pre></pre>
<p>ä¸‹é¢æˆ‘ä»¬æ¥æ„å»ºçº¦æŸ :</p>
<ul>
<li>æœ€å…³é”®çš„å‡½æ•° <em>configure</em> å’Œ <em>enable_equality</em> ç”¨äºæ£€æŸ¥ä¼ å…¥å‚æ•°çš„ç›¸ç­‰æ€§</li>
<li>å¦‚ä¸‹å›¾ : åœ¨ <code>create_gate</code> å‡½æ•°ä¸­ :
<ul>
<li>ä¹˜æ•° <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span> åˆ†åˆ«åœ¨åŒä¸€è¡Œçš„ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  advice åˆ—  ;</li>
<li>ä¹˜ç§¯ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span>  å’Œ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> åŒåœ¨ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åˆ—, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span> åœ¨ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>  çš„ä¸‹ä¸€è¡Œ :</li>
</ul>
</li>
<li>å¯ä»¥çœ‹åˆ°åœ¨ä»£ç ä¸­, éƒ½æ˜¯ä½¿ç”¨ç›¸å¯¹ä½ç½®(relative position) æ¥æè¿°çš„ !</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// | a0  | a1  | s_mul |
// |-----|-----|-------|
// | lhs | rhs | s_mul |
// | out |     |       |
let lhs = meta.query_advice(advice[0], Rotation::cur());
let rhs = meta.query_advice(advice[1], Rotation::cur());
let out = meta.query_advice(advice[0], Rotation::next()); // Attention !!
<span class="boring">}</span></code></pre></pre>
<p>æœ€åå‡½æ•°è¿”å›å¤šé¡¹å¼çº¦æŸï¼š</p>
<ul>
<li>è‹¥é€‰æ‹©å™¨(Selector) <code>s_mul</code> ä¸ä¸º 0ï¼Œåˆ™<strong>æ¿€æ´»</strong>æ ¡éªŒä¹˜æ³•çº¦æŸ :
<ul>
<li>å½“ <code>s_mul * (lhs * rhs - out) == 0</code>ï¼Œåˆ™è¯´æ˜ <em>lhs * rhs = out</em> çº¦æŸæˆç«‹ï¼›</li>
<li>å½“ <code>s_mul * (lhs * rhs - out) != 0</code>ï¼Œè¯´æ˜  <em>lhs * rhs = out</em> çº¦æŸä¸æˆç«‹ï¼ï¼ç¨‹åºæŠ¥é”™</li>
</ul>
</li>
<li>è‹¥ <code>s_mul</code> ä¸º 0ï¼Œåˆ™<strong>ä¸ä¼šæ¿€æ´»</strong>æ£€æŸ¥ä¹˜æ³•çº¦æŸï¼Œany subsequent values are fineï¼</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;F: FieldExt&gt; FieldChip&lt;F&gt; {
    fn construct(config: &lt;Self as Chip&lt;F&gt;&gt;::Config) -&gt; Self {
        Self {
            config,
            _marker: PhantomData,
        }
    }

    fn configure(
        meta: &amp;mut ConstraintSystem&lt;F&gt;,
        advice: [Column&lt;Advice&gt;; 2],
        instance: Column&lt;Instance&gt;,
        constant: Column&lt;Fixed&gt;,
    ) -&gt; &lt;Self as Chip&lt;F&gt;&gt;::Config {
        meta.enable_equality(instance);
        meta.enable_constant(constant);
        for column in &amp;advice {
            meta.enable_equality(*column);
        }
        let s_mul = meta.selector();

        // å®šä¹‰æˆ‘ä»¬çš„ä¹˜æ³•é—¨ï¼ˆmultiplication gateï¼‰
        meta.create_gate("mul", |meta| {
            // To implement multiplication, we need 3 advice `cells`
            // and 1 selector.  We arrange them like so:
            //
            // | a0  | a1  | s_mul |
            // |-----|-----|-------|
            // | lhs | rhs | s_mul |
            // | out |     |       |
            //
            // é—¨å¯ä»¥ç”¨ä»»æ„ç›¸å¯¹åç§»(relative offsets)ï¼Œä½†æ¯ä¸€ä¸ª offset éƒ½ä¼šå¢åŠ è¯æ˜çš„å¼€é”€
            // æœ€å¸¸è§çš„åç§»å€¼ offset æ˜¯ 0 (å½“å‰è¡Œ), 1(ä¸‹ä¸€è¡Œ), -1(ä¸Šä¸€è¡Œ)ã€‚
            // è¿™ 3 ç§æƒ…å†µ `Rotation` éƒ½æœ‰ç‰¹å®šçš„ constructors : cur/next/prev
            let lhs = meta.query_advice(advice[0], Rotation::cur());
            let rhs = meta.query_advice(advice[1], Rotation::cur());
            let out = meta.query_advice(advice[0], Rotation::next());
            let s_mul = meta.query_selector(s_mul);

            // Finally, we return the polynomial expressions that constrain this gate.
            // æœ€ç»ˆï¼Œæˆ‘ä»¬å°†çº¦æŸé—¨çš„å¤šé¡¹å¼è¡¨è¾¾å¼è¿”å›. å¯¹äºç›®å‰çš„ä¹˜æ³•é—¨ï¼Œä»…éœ€è¦ä¸€ä¸ªå¤šé¡¹å¼çº¦æŸ
            //
            // `create_gate` å‡½æ•°è¿”å›çš„å¤šé¡¹å¼è¡¨è¾¾å¼ï¼Œåœ¨ proving system ä¸­ä¼šè¢«çº¦æŸç­‰äº 0.
            // çº¦æŸè¡¨è¾¾å¼æœ‰ä»¥ä¸‹æ€§è´¨ï¼š
            // - å½“ s_mul = 0 æ—¶ï¼Œlhs, rhs, out å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚
            // - å½“ s_mul != 0 æ—¶ï¼Œlhs, rhs, out éœ€è¦æ»¡è¶³ lhs * rhs = out è¿™æ¡çº¦æŸã€‚
            vec![s_mul * (lhs * rhs - out)]
        });

        FieldConfig {
            advice,
            instance,
            s_mul,
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹ç”µè·¯çš„å®ç°çš„å¤§è‡´è¿‡ç¨‹æ˜¯ï¼š</p>
<ol>
<li>å®šä¹‰ä¸€å¥—æŒ‡ä»¤é›†ï¼ˆNumericInstructionsï¼‰ï¼Œè¿™æ˜¯ä¸€å¥—æ“ä½œç ï¼Œç”¨æ¥æ§åˆ¶â€œè®¡ç®—æœºâ€œ(èŠ¯ç‰‡)</li>
<li>å˜å‡ºä¸€å—èŠ¯ç‰‡ï¼ˆå®šä¹‰åœ¨æœ‰é™åŸŸä¸Šï¼‰ï¼Œå°±åƒæ˜¯ä¸€å—ç”µè·¯æ¿</li>
<li>æœ‰äº†â€æŒ‡ä»¤é›†â€œå’Œâ€ç”µè·¯æ¿â€œï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€äº›å…ƒä»¶æ¥å¯¹è¯¥ç”µè·¯æ¿å­å®ç°ç‰¹å®šåŠŸèƒ½(struct FieldConfig)ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæƒ³å®ç°å£°æ§åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç”µå®¹éº¦ï¼Œæ¨¡æ‹Ÿ-æ•°å­—è½¬æ¢å™¨ (ADC)ï¼ŒäºŒæç®¡â€¦ åœ¨ halo2 ä¸­ï¼Œæˆ‘ä»¬å°±éœ€è¦é€‰å–éœ€è¦çš„ column: advice/instance/constant/selectors â€¦.</li>
<li>æœ‰äº†è¿™äº›å…ƒå™¨ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§æ‰§è¡Œé€»è¾‘å°†å…¶è¿æ¥èµ·æ¥(fn configure())</li>
</ol>
<p><img src="imgs/1/Pastedimage20230912220538.png" alt="" /></p>
<h4 id="å®ç°-chip-traits"><a class="header" href="#å®ç°-chip-traits"><a href="https://trapdoor-tech.github.io/halo2-book-chinese/user/simple-example.html#%E5%AE%9E%E7%8E%B0%E8%8A%AF%E7%89%87%E5%8A%9F%E8%83%BD">å®ç° chip Traits</a></a></h4>
<p>æˆ‘ä»¬å‰é¢å®šä¹‰çš„ <code>instructions interface</code> éœ€è¦ implementionï¼Œå®šä¹‰ <code>NumericInstructions</code> çš„å®ç°å°±æ˜¯å°è£… finite field elements.</p>
<p>It should be noted that, é™¤äº†è¡Œå’Œåˆ—ä¹‹å¤–ï¼ŒCell å•å…ƒçš„ä½ç½®è¿˜å¯ä»¥é€šè¿‡ç›¸å¯¹ä½ç½®åç§»(relative position offset) æ¥ç¡®å®š)</p>
<blockquote>
<p>Generally, there are <code>3</code> types of offsets, <code>0</code> representing the current position, <code>1</code> representing the next position, and <code>-1</code> representing the previous position.</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Number&lt;F: Field&gt;(AssignedCell&lt;F, F&gt;); /// ç”¨äºè¡¨ç¤ºæ•°çš„ struct

impl&lt;F: FieldExt&gt; NumericInstructions&lt;F&gt; for FieldChip&lt;F&gt; {
    type Num = Number&lt;F&gt;;
    fn load_private(){ ... }
    fn load_constant(){ ... }

    fn mul(
        &amp;self,
        mut layouter: impl Layouter&lt;F&gt;,
        a: Self::Num,
        b: Self::Num,
    ) -&gt; Result&lt;Self::Num, Error&gt; {
        let config = self.config();

        layouter.assign_region(
            || "mul",
            |mut region: Region&lt;'_, F&gt;| {
                // åœ¨æ­¤ region ä¸­ï¼Œæˆ‘ä»¬åªæƒ³ç”¨ä¸€ä¸ªä¹˜æ³•é—¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ region offset=0 å¤„æ¿€æ´»å®ƒï¼›
                // è¿™æ„å‘³ç€å®ƒå°†å¯¹ offsets 0 and 1 å¤„çš„ 2 ä¸ª cells éƒ½è¿›è¡Œçº¦æŸ(ä¸ºå•¥ï¼Ÿ)
                config.s_mul.enable(&amp;mut region, 0)?;

                // ç»™æˆ‘ä»¬çš„è¾“å…¥(a: Self::Num / b: Self::Num,) æœ‰å¯èƒ½åœ¨ç”µè·¯çš„ä»»ä½•ä½ç½®.
                // ä½†åœ¨region ä¸­ï¼Œæˆ‘ä»¬åªèƒ½ä¾é ç›¸å¯¹åç§»ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ region å†…åˆ†é…æ–°çš„ cells
                // å¹¶é™åˆ¶æ–°åˆ†é…çš„ cells çš„å€¼ ä¸è¾“å…¥(a: Self::Num / b: Self::Num,) çš„å€¼ç›¸ç­‰ã€‚
                a.0.copy_advice(|| "lhs", &amp;mut region, config.advice[0], 0)?;
                b.0.copy_advice(|| "rhs", &amp;mut region, config.advice[1], 0)?;

                // ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠä¹˜ç§¯æ”¾åˆ°è¾“å‡ºçš„ä½ç½®äº†ã€‚
                let value = a.0.value().copied() * b.0.value();

				// æœ€åï¼Œæˆ‘ä»¬å¯¹è¾“å‡ºè¿›è¡Œèµ‹å€¼ï¼Œè¿”å›ä¸€ä¸ªè¦åœ¨ç”µè·¯çš„å¦ä¸€éƒ¨åˆ†ä½¿ç”¨çš„å˜é‡
                region
                    .assign_advice(|| "lhs * rhs", config.advice[0], 1, || value)
                    .map(Number)
            },
        )
    }
    fn expose_public(
        &amp;self,
        mut layouter: impl Layouter&lt;F&gt;,
        num: Self::Num,
        row: usize,
    ) -&gt; Result&lt;(), Error&gt; {
        let config = self.config();

        layouter.constrain_instance(num.0.cell(), config.instance, row)
    }
}
<span class="boring">}</span></code></pre></pre>
<h4 id="æ„å»ºç”µè·¯"><a class="header" href="#æ„å»ºç”µè·¯"><a href="https://trapdoor-tech.github.io/halo2-book-chinese/user/simple-example.html#%E6%9E%84%E9%80%A0%E7%94%B5%E8%B7%AF">æ„å»ºç”µè·¯</a></a></h4>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†æ‰€éœ€çš„æŒ‡ä»¤ä»¥åŠå®ç°å®ƒä»¬çš„èŠ¯ç‰‡ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æ„å»ºæˆ‘ä»¬çš„ç”µè·¯äº†ï¼</p>
<p><strong>circuit</strong> Trait æ˜¯ç”µè·¯å¼€å‘çš„å…¥å£ã€‚ æˆ‘ä»¬éœ€è¦å®šä¹‰è‡ªå·±çš„ç”µè·¯ç»“æ„å¹¶è®¿é—® <em>witness</em> input</p>
<p>struct <code>MyCircuit</code> :</p>
<ul>
<li>åœ¨è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œæˆ‘ä»¬ä¿å­˜éšç§è¾“å…¥å˜é‡ã€‚æˆ‘ä»¬ä½¿ç”¨  <code>Option&lt;F&gt;</code> ç±»å‹æ˜¯å› ä¸ºï¼Œåœ¨ç”Ÿæˆå¯†é’¥é˜¶æ®µï¼Œä»–ä»¬ä¸éœ€è¦æœ‰ä»»ä½•çš„å€¼ã€‚åœ¨è¯æ˜é˜¶æ®µä¸­ï¼Œå¦‚æœå®ƒä»¬ä»»ä¸€ä¸º <code>None</code> çš„è¯ï¼Œå°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚</li>
</ul>
<p>The interfaces defined before are all used here.Â <em>configure</em>Â creates a storage column for advice/instance/constant.Â <em>synthesize</em>Â uses a custom chip to get the input witness and constant, and finally, calculate the result and return the public input.</p>
<p>In fact, it can satisfy most scenarios by simply implementing theÂ <em>circuit</em>Â trait for general circuit development. Some common functions of the chip have already been implemented in Halo 2.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Store the private input variables in this circuit.
// Value&lt;F&gt; ç”¨äº† Option&lt;F&gt;,  å› ä¸ºåœ¨ key generation é˜¶æ®µè¿™ä¸ª struct ä¸ä¼šæœ‰å€¼
// è€Œåœ¨ Proving é˜¶æ®µï¼Œå¦‚æœä»»æ„ä½ç½®ä¸ºç©ºå°±ä¼š throw Error.
struct MyCircuit&lt;F: Field&gt; {
    constant: F,
    a: Value&lt;F&gt;,
    b: Value&lt;F&gt;,
}

impl&lt;F: Field&gt; Circuit&lt;F&gt; for MyCircuit&lt;F&gt; {
    // å› ä¸º we are using a single chip for everythingï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡ç”¨å®ƒçš„é…ç½®ã€‚
    type Config = FieldConfig;  // ç”µè·¯å…ƒä»¶(column(advice/instance/selector..))
    type FloorPlanner = SimpleFloorPlanner;

    fn without_witnesses(&amp;self) -&gt; Self {
        Self::default()
    }

    fn configure(meta: &amp;mut ConstraintSystem&lt;F&gt;) -&gt; Self::Config {
        // æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ª advice åˆ—ï¼Œä½œä¸º FieldChip çš„ I/O.
        let advice = [meta.advice_column(), meta.advice_column()];

        // æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª instance åˆ—æ¥å­˜å‚¨å…¬å¼€è¾“å…¥ public inputs.
        let instance = meta.instance_column();

        // åˆ›å»ºä¸€ä¸ª fixed åˆ—æ¥åŠ è½½å¸¸æ•° load constants.
        let constant = meta.fixed_column();

        FieldChip::configure(meta, advice, instance, constant)
    }
    // Prove a2â‹…b2 = c
    fn synthesize(
        &amp;self,
        config: Self::Config,
        mut layouter: impl Layouter&lt;F&gt;,
    ) -&gt; Result&lt;(), Error&gt; {
        let field_chip = FieldChip::&lt;F&gt;::construct(config);

        // å°†æˆ‘ä»¬çš„éšç§å€¼åŠ è½½åˆ°ç”µè·¯ä¸­ã€‚
        let a = field_chip.load_private(layouter.namespace(|| "load a"), self.a)?;
        let b = field_chip.load_private(layouter.namespace(|| "load b"), self.b)?;

        // å°†å¸¸æ•°å› å­åŠ è½½åˆ°ç”µè·¯ä¸­
        let constant =
            field_chip.load_constant(layouter.namespace(|| "load constant"), self.constant)?;

        // æˆ‘ä»¬ä»…æœ‰ä¹˜æ³•å¯ç”¨ï¼Œå› æ­¤æˆ‘ä»¬æŒ‰ä»¥ä¸‹æ–¹æ³•å®ç°ç”µè·¯ï¼š
        //     asq  = a * a
        //     bsq  = b * b
        //     absq = asq * bsq
        //     c    = constant * asq*bsq
        //
        // ä½†æ˜¯ï¼ŒæŒ‰ä¸‹é¢çš„æ–¹æ³•å®ç°ï¼Œæ›´åŠ é«˜æ•ˆ:
        //     ab   = a*b
        //     absq = ab^2
        //     c    = constant*absq
        let ab = field_chip.mul(layouter.namespace(|| "a * b"), a, b)?;
        let absq = field_chip.mul(layouter.namespace(|| "ab * ab"), ab.clone(), ab)?;
        let c = field_chip.mul(layouter.namespace(|| "constant * absq"), constant, absq)?;

        // å°†ç»“æœä½œä¸ºç”µè·¯çš„å…¬å¼€è¾“å…¥è¿›è¡Œå…¬å¼€
        field_chip.expose_public(layouter.namespace(|| "expose c"), c, 0)
    }
} }
<span class="boring">}</span></code></pre></pre>
<h4 id="æµ‹è¯•ç”µè·¯"><a class="header" href="#æµ‹è¯•ç”µè·¯"><a href="https://zcash.github.io/halo2/user/simple-example.html#testing-the-circuit">æµ‹è¯•ç”µè·¯</a></a></h4>
<p>æˆ‘ä»¬åœ¨ chapter about tools ä¸­æåˆ°çš„ <em>MockProver</em> å’Œ <em>CircuitLayout</em> å¯ä»¥æ´¾ä¸Šç”¨åœº</p>
<p>å¯ä»¥ç”¨Â <code>halo2::dev::MockProver</code>Â æ¥æµ‹è¯•ä¸€ä¸ªç”µè·¯æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚æ„é€ ç”µè·¯çš„ä¸€ç»„ Private/Public input ï¼Œè¿™ç»„è¾“å…¥å¯ç›´æ¥ç”¨æ¥è®¡ç®—åˆæ³•è¯æ˜ï¼Œä½†æˆ‘ä»¬æŠŠè¿™ç»„è¾“å…¥ä¼ å…¥åˆ° <code>MockProver::run</code> å‡½æ•°ä¸­ä¹‹åï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªå¯ç”¨äºæ£€éªŒç”µè·¯ä¸­æ¯ä¸€æ¡çº¦æŸæ˜¯å¦æ»¡è¶³çš„å¯¹è±¡ã€‚è€Œä¸”ç”µè·¯éªŒè¯ä¸è¿‡ï¼Œè¿™ä¸ªå¯¹è±¡è¿˜èƒ½è¾“å‡ºé‚£æ¡ä¸æ»¡è¶³çš„çº¦æŸ</p>
<p>å¦‚ä¸‹ä»£ç  , <code>MockProver::run</code>  ä¸­åªçŸ¥é“ Public input <code>c</code> , ä»–å¹¶ä¸çŸ¥é“ Private æ˜¯ä»€ä¹ˆ, ä½†ä»å¯ä»¥è¿›è¡ŒéªŒè¯</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    // æˆ‘ä»¬ç”µè·¯çš„è¡Œæ•°ä¸èƒ½è¶…è¿‡ 2^k. å› ä¸ºæˆ‘ä»¬çš„ç¤ºä¾‹ç”µè·¯å¾ˆå°ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªè¾ƒå°çš„å€¼
    let k = 4;

    // å‡†å¤‡å¥½ç”µè·¯çš„éšç§è¾“å…¥å’Œå…¬å¼€è¾“å…¥
    let constant = Fp::from(7);
    let a = Fp::from(2);
    let b = Fp::from(3);
    let c = constant * a.square() * b.square();  // ç®—å‡ºæ¥

    // ç”¨éšç§è¾“å…¥æ¥å®ä¾‹åŒ–ç”µè·¯
    let circuit = MyCircuit {
        constant,
        a: Value::known(a),
        b: Value::known(b),
    };

    // å°†å…¬å¼€è¾“å…¥è¿›è¡Œæ’åˆ—ã€‚ä¹˜æ³•çš„ç»“æœè¢«æˆ‘ä»¬æ”¾ç½®åœ¨ instance åˆ—çš„ç¬¬0è¡Œï¼Œ
    // æ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨å…¬å¼€è¾“å…¥çš„å¯¹åº”ä½ç½®ã€‚
    let mut public_inputs = vec![c];

    // ç»™å®šæ­£ç¡®çš„å…¬å¼€è¾“å…¥ï¼Œæˆ‘ä»¬çš„ç”µè·¯èƒ½éªŒè¯é€šè¿‡
    let prover = MockProver::run(k, &amp;circuit, vec![public_inputs.clone()]).unwrap();
    assert_eq!(prover.verify(), Ok(()));

    // å¦‚æœæˆ‘ä»¬å°è¯•ç”¨å…¶ä»–çš„å…¬å¼€è¾“å…¥(æ­¤å¤„æ˜¯ +1)ï¼Œè¯æ˜å°†å¤±è´¥ï¼
    public_inputs[0] += Fp::one();
    let prover = MockProver::run(k, &amp;circuit, vec![public_inputs]).unwrap();
    assert!(prover.verify().is_err());
}</code></pre></pre>
<h3 id="code-ref--full-example"><a class="header" href="#code-ref--full-example">Code Ref / <a href="https://zcash.github.io/halo2/user/simple-example.html#full-example">Full example</a></a></h3>
<p>You can find the source code for this exampleÂ <a href="https://github.com/zcash/halo2/tree/main/halo2_proofs/examples/simple-example.rs">here</a>.</p>
<pre><code class="language-bash">cargo run --example simple-example
</code></pre>
<h3 id="references"><a class="header" href="#references">References:</a></h3>
<ul>
<li><a href="https://github.com/jasonmorton/halo2-examples/blob/master/src/fibonacci/example1.rs">Jason Morton halo2 codes</a></li>
<li><a href="https://zcash.github.io/halo2/user/simple-example.html#define-a-chip-implementation">ZCash halo2 books</a></li>
<li><a href="https://trapdoor-tech.github.io/halo2-book-chinese/user/simple-example.html">trapdoor-tech halo2 book</a></li>
<li><a href="https://github.com/icemelon/halo2-examples/blob/master/src/fibonacci/example3.rs">icemelon/HaiCheng Shen</a></li>
<li><a href="https://learn.0xparc.org/">0xPARC halo2</a></li>
</ul>
<h3 id="-ä¸­æ–‡ç‰ˆæœ¬-end-"><a class="header" href="#-ä¸­æ–‡ç‰ˆæœ¬-end-">â€”â€“ ä¸­æ–‡ç‰ˆæœ¬ End â€”â€”</a></h3>
<h3 id="simple-example"><a class="header" href="#simple-example">Simple Example</a></h3>
<p>Letâ€™s start with a simple circuit, to introduce you to the common APIs and how they are used. The circuit will take a public inputÂ c, and will prove knowledge of two private inputsÂ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>Â andÂ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>Â such that
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></span></p>
<h4 id="define-instructions"><a class="header" href="#define-instructions"><a href="https://zcash.github.io/halo2/user/simple-example.html#define-instructions">Define instructions</a></a></h4>
<p>Instructions are the boundary between high-levelÂ <a href="https://zcash.github.io/halo2/concepts/gadgets.html">gadgets</a>Â and the low-level circuit operations. Instructions may be as coarse or as granular as desired, but in practice you want to strike a balance between an instruction being large enough to effectively optimize its implementation, and small enough that it is meaningfully reusable.</p>
<p>For our circuit, we will use three instructions:</p>
<ul>
<li>Load a private number into the circuit.</li>
<li>Multiply two numbers.</li>
<li>Expose a number as a public input to the circuit. (å°†ä¸€ä¸ªæ•°è®¾ç½®ä¸ºç”µè·¯çš„å…¬å¼€è¾“å…¥)</li>
</ul>
<p>We also need a type for a variable representing a number. Instruction interfaces provide associated types for their inputs and outputs, to allow the implementations to represent these in a way that makes the most sense for their optimization goals.
æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä»£è¡¨æ•°å­—çš„å˜é‡çš„ç±»å‹ã€‚æŒ‡ä»¤æ¥å£ä¸ºå…¶è¾“å…¥å’Œè¾“å‡ºæä¾›å…³è”ç±»å‹ï¼Œä»¥å…è®¸å®ç°ä»¥å¯¹å…¶ä¼˜åŒ–ç›®æ ‡æœ€æœ‰æ„ä¹‰çš„æ–¹å¼è¡¨ç¤ºè¿™äº›ç±»å‹</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait NumericInstructions&lt;F: Field&gt;: Chip&lt;F&gt; {
    /// Variable representing a number. ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ•°çš„å˜é‡
    type Num;

    /// Loads a number into the circuit as a private input. éšç§è¾“å…¥
    fn load_private(&amp;self, layouter: impl Layouter&lt;F&gt;, a: Value&lt;F&gt;) -&gt; Result&lt;Self::Num, Error&gt;;

    /// Loads a number into the circuit as a fixed constant.
    fn load_constant(&amp;self, layouter: impl Layouter&lt;F&gt;, constant: F) -&gt; Result&lt;Self::Num, Error&gt;;

    /// Returns `c = a * b`.
    fn mul(
        &amp;self,
        layouter: impl Layouter&lt;F&gt;,
        a: Self::Num,
        b: Self::Num,
    ) -&gt; Result&lt;Self::Num, Error&gt;;

    /// Exposes a number as a public input to the circuit.
    /// å°†ä¸€ä¸ªæ•°ç½®ä¸ºç”µè·¯çš„å…¬å¼€è¾“å…¥
    fn expose_public(
        &amp;self,
        layouter: impl Layouter&lt;F&gt;,
        num: Self::Num,
        row: usize,
    ) -&gt; Result&lt;(), Error&gt;;
}
<span class="boring">}</span></code></pre></pre>
<p>Among them,</p>
<ul>
<li><em>Num</em> is used to adapt to the type handled in this interface, (é€‚é…è¯¥æ¥å£ä¸­å¤„ç†çš„ç±»å‹)</li>
<li><em>load_private</em>Â is used to load witness,</li>
<li><em>load_constant</em>Â is used to load constants,Â </li>
<li><em>mul</em>Â is used to calculate the multiplication of two numbers, andÂ </li>
<li><em>expose_public</em>Â is used to set instance.</li>
</ul>
<h4 id="define-a-chip-implementation"><a class="header" href="#define-a-chip-implementation"><a href="https://zcash.github.io/halo2/user/simple-example.html#define-a-chip-implementation">Define a chip implementation</a></a></h4>
<p>å®šä¹‰èŠ¯ç‰‡çš„å®ç° : For our circuit, we will build aÂ <a href="https://zcash.github.io/halo2/concepts/chips.html">chip</a>Â that provides the above numeric instructions for a finite field.</p>
<p>If you want to develop a custom chip, you need to implement theÂ <em>chip</em>Â trait of Halo 2.</p>
<p>Most of the time, using Halo 2 for circuit development does not need to define instructions and chips by oneself. But if you need to use complex ones that Halo 2 does not provide, you need to implement them yourself, such as implementing an emerging(æ–°å…´çš„) cryptographic algorithm.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// è¿™å—èŠ¯ç‰‡å°†å®ç°æˆ‘ä»¬çš„æŒ‡ä»¤é›†ï¼èŠ¯ç‰‡å­˜å‚¨å®ƒä»¬è‡ªå·±çš„é…ç½®ï¼Œ
struct FieldChip&lt;F: Field&gt; {
    config: FieldConfig,
    _marker: PhantomData&lt;F&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>Every chip needs to implement the Â <code>Chip</code>Â  trait.  This defines the properties of the chip that aÂ <code>Layouter</code>Â may rely on when synthesizing a circuit, as well as enabling any initial state that the chip requires to be loaded into the circuit.
æ¯ä¸€ä¸ªâ€œèŠ¯ç‰‡â€œç±»å‹éƒ½è¦å®ç° <code>Chip</code> trait , <code>Chip</code> trait å®šä¹‰äº† <code>Layouter</code> åœ¨ synthesizing ç”µè·¯æ—¶å¯èƒ½éœ€è¦çš„å…³äºç”µè·¯çš„æŸäº›å±æ€§ï¼Œä»¥åŠè‹¥å°†è¯¥èŠ¯ç‰‡åŠ è½½åˆ°ç”µè·¯æ‰€éœ€è¦è®¾ç½®çš„ä»»ä½•åˆå§‹çŠ¶æ€</p>
<blockquote>
<p>synthesizing ç”µè·¯ : ä¸€èˆ¬æŒ‡çš„æ˜¯ç±»ä¼¼ R1CS é‚£ç§å†™çº¦æŸçš„æ„æ€</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;F: FieldExt&gt; Chip&lt;F&gt; for FieldChip&lt;F&gt; {
    type Config = FieldConfig;
    type Loaded = ();

    fn config(&amp;self) -&gt; &amp;Self::Config {
        &amp;self.config
    }

    fn loaded(&amp;self) -&gt; &amp;Self::Loaded {
        &amp;()
    }
}
<span class="boring">}</span></code></pre></pre>
<h4 id="configure-the-chip"><a class="header" href="#configure-the-chip"><a href="https://zcash.github.io/halo2/user/simple-example.html#configure-the-chip">Configure the chip</a></a></h4>
<p>The chip needs to be configured with the columns, permutations, and gates that will be required to implement all of the desired instructions.  (éœ€è¦ä¸ºèŠ¯ç‰‡é…ç½®å¥½å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½æ‰€éœ€è¦çš„é‚£äº›åˆ—ã€ç½®æ¢ã€é—¨) :</p>
<pre><pre class="playground"><code class="language-rust">#![allow(unused)]
fn main() {
/// èŠ¯ç‰‡çš„çŠ¶æ€è¢«å­˜å‚¨åœ¨ä¸€ä¸ª config ç»“æ„ä½“ä¸­ï¼Œå®ƒæ˜¯åœ¨é…ç½®è¿‡ç¨‹ä¸­ç”±èŠ¯ç‰‡ç”Ÿæˆï¼Œ
/// å¹¶ä¸”å­˜å‚¨åœ¨èŠ¯ç‰‡å†…éƒ¨ã€‚
#[derive(Clone, Debug)]
struct FieldConfig {
    /// å¯¹äºè¿™å—èŠ¯ç‰‡ï¼Œæˆ‘ä»¬å°†ç”¨åˆ°ä¸¤ä¸ª advice åˆ—æ¥å®ç°æˆ‘ä»¬çš„æŒ‡ä»¤é›†ã€‚
    /// å®ƒä»¬ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ç”µè·¯çš„å…¶ä»–éƒ¨åˆ†é€šä¿¡æ‰€éœ€è¦ç”¨åˆ°åˆ—ã€‚
    advice: [Column&lt;Advice&gt;; 2],
    instance: Column&lt;Instance&gt;, //å…¬å¼€è¾“å…¥ï¼ˆinstanceï¼‰åˆ—

    // æˆ‘ä»¬éœ€è¦ä¸€ä¸ª selector æ¥æ¿€æ´»ä¹˜æ³•é—¨ï¼Œä»è€Œåœ¨ç”¨ä¸åˆ°`NumericInstructions::mul`æŒ‡ä»¤çš„
    //cells ä¸Šä¸è®¾ç½®ä»»ä½•çº¦æŸã€‚è¿™éå¸¸é‡è¦ï¼Œå°¤å…¶åœ¨æ„å»ºæ›´å¤§å‹çš„ç”µè·¯çš„æƒ…å†µä¸‹ï¼Œåˆ—ä¼šè¢«å¤šæ¡æŒ‡ä»¤é›†ç”¨åˆ°
    s_mul: Selector,

    /// ç”¨æ¥åŠ è½½å¸¸æ•°çš„ fixed åˆ—
    constant: Column&lt;Fixed&gt;,
}</code></pre></pre>
<p>ä¸‹é¢æˆ‘ä»¬æ¥æ„å»ºçº¦æŸ :</p>
<ul>
<li>the most critical functionsÂ <em>configure</em>Â andÂ <em>enable_equality</em>Â are used to check the equality of the incoming parameters(ä¼ å…¥çš„å‚æ•°).</li>
<li>å¦‚ä¸‹å›¾ : åœ¨ <code>create_gate</code> å‡½æ•°ä¸­ :
<ul>
<li>ä¹˜æ•° <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span> åˆ†åˆ«åœ¨åŒä¸€è¡Œçš„ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  advice åˆ—  ;</li>
<li>ä¹˜ç§¯ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span>  å’Œ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> åŒåœ¨ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åˆ—, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span> åœ¨ <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>  çš„ä¸‹ä¸€è¡Œ :</li>
</ul>
</li>
<li>å¯ä»¥çœ‹åˆ°åœ¨ä»£ç ä¸­, éƒ½æ˜¯ä½¿ç”¨ ç›¸å¯¹ä½ç½®æ¥æè¿°çš„ !</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// | a0  | a1  | s_mul |
// |-----|-----|-------|
// | lhs | rhs | s_mul |
// | out |     |       |
let lhs = meta.query_advice(advice[0], Rotation::cur());
let rhs = meta.query_advice(advice[1], Rotation::cur());
let out = meta.query_advice(advice[0], Rotation::next()); // Attention !!
<span class="boring">}</span></code></pre></pre>
<p>æœ€åå‡½æ•°è¿”å›å¤šé¡¹å¼çº¦æŸï¼š</p>
<ul>
<li>è‹¥ <code>s_mul</code> ä¸ä¸º 0ï¼Œåˆ™<strong>æ¿€æ´»</strong>æ ¡éªŒä¹˜æ³•çº¦æŸ :
<ul>
<li>å½“ <code>s_mul * (lhs * rhs - out) == 0</code>ï¼Œåˆ™ <em>lhs * rhs = out</em> çº¦æŸæˆç«‹ï¼›</li>
<li>å½“ <code>s_mul * (lhs * rhs - out) != 0</code>ï¼Œ <em>lhs * rhs = out</em> çº¦æŸä¸æˆç«‹ï¼›ç¨‹åºæŠ¥é”™</li>
</ul>
</li>
<li>è‹¥ <code>s_mul</code> ä¸º 0ï¼Œåˆ™<strong>ä¸ä¼šæ¿€æ´»</strong>æ£€æŸ¥ä¹˜æ³•çº¦æŸï¼Œany subsequent values are fine</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;F: FieldExt&gt; FieldChip&lt;F&gt; {
    fn construct(config: &lt;Self as Chip&lt;F&gt;&gt;::Config) -&gt; Self {
        Self {
            config,
            _marker: PhantomData,
        }
    }

    fn configure(
        meta: &amp;mut ConstraintSystem&lt;F&gt;,
        advice: [Column&lt;Advice&gt;; 2],
        instance: Column&lt;Instance&gt;,
        constant: Column&lt;Fixed&gt;,
    ) -&gt; &lt;Self as Chip&lt;F&gt;&gt;::Config {
        meta.enable_equality(instance.into());
        meta.enable_constant(constant);
        for column in &amp;advice {
            meta.enable_equality((*column).into());
        }
        let s_mul = meta.selector();

        // å®šä¹‰æˆ‘ä»¬çš„ä¹˜æ³•é—¨
        meta.create_gate("mul", |meta| {
            // To implement multiplication, we need 3 advice `cells`
            // and 1 selector.  We arrange them like so:
            //
            // | a0  | a1  | s_mul |
            // |-----|-----|-------|
            // | lhs | rhs | s_mul |
            // | out |     |       |
            //
            // é—¨å¯ä»¥ç”¨ä»»ä¸€ç›¸å¯¹åç§»ï¼Œä½†æ¯ä¸€ä¸ªä¸åŒçš„åç§»éƒ½ä¼šå¯¹è¯æ˜å¢åŠ å¼€é”€ã€‚
            // æœ€å¸¸è§çš„åç§»å€¼æ˜¯ 0 (å½“å‰è¡Œ), 1(ä¸‹ä¸€è¡Œ), -1(ä¸Šä¸€è¡Œ)ã€‚
            // é’ˆå¯¹è¿™ä¸‰ç§æƒ…å†µï¼Œæœ‰ç‰¹å®šçš„æ„é€ å‡½æ•°æ¥æ„é€ `Rotation` ç»“æ„ã€‚
            let lhs = meta.query_advice(advice[0], Rotation::cur());
            let rhs = meta.query_advice(advice[1], Rotation::cur());
            let out = meta.query_advice(advice[0], Rotation::next());
            let s_mul = meta.query_selector(s_mul);

            // æœ€ç»ˆï¼Œæˆ‘ä»¬å°†çº¦æŸé—¨çš„å¤šé¡¹å¼è¡¨è¾¾å¼è¿”å›ã€‚
            // å¯¹äºæˆ‘ä»¬çš„ä¹˜æ³•é—¨ï¼Œæˆ‘ä»¬ä»…éœ€è¦ä¸€ä¸ªå¤šé¡¹å¼çº¦æŸã€‚
            //
            // `create_gate` å‡½æ•°è¿”å›çš„å¤šé¡¹å¼è¡¨è¾¾å¼ï¼Œåœ¨è¯æ˜ç³»ç»Ÿä¸­ä¸€å®šç­‰äº0ã€‚
            // æˆ‘ä»¬çš„è¡¨è¾¾å¼æœ‰ä»¥ä¸‹æ€§è´¨ï¼š
            // - å½“ s_mul = 0 æ—¶ï¼Œlhs, rhs, out å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚
            // - å½“ s_mul != 0 æ—¶ï¼Œlhs, rhs, out å°†æ»¡è¶³ lhs * rhs = out è¿™æ¡çº¦æŸã€‚
            vec![s_mul * (lhs * rhs - out)]
        });

        FieldConfig {
            advice,
            instance,
            s_mul,
            constant,
        }
    }
}
}
<span class="boring">}</span></code></pre></pre>
<h4 id="implement-chip-traits"><a class="header" href="#implement-chip-traits"><a href="https://trapdoor-tech.github.io/halo2-book-chinese/user/simple-example.html#%E5%AE%9E%E7%8E%B0%E8%8A%AF%E7%89%87%E5%8A%9F%E8%83%BD">Implement chip Traits</a></a></h4>
<p>The <code>instructions interface</code> we defined earlier needs to be implemented, and defining the implementation of Number is to en<strong>capsul</strong>ate(å°è£…) finite field elements.</p>
<p>It should be noted that, in addition to row and column, the position of the cell can also be determined by the relative position offset  (é™¤äº†è¡Œå’Œåˆ—ä¹‹å¤–ï¼Œå•å…ƒçš„ä½ç½®è¿˜å¯ä»¥é€šè¿‡ç›¸å¯¹ä½ç½®åç§»æ¥ç¡®å®š).</p>
<p>Generally, there are <code>3</code> types of offsets, 0 representing the current position, <code>1</code> representing the next position, and <code>-1</code> representing the previous position.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// A variable representing a number.
#[derive(Clone)]
struct Number&lt;F: Field&gt;(AssignedCell&lt;F, F&gt;);

impl&lt;F: Field&gt; NumericInstructions&lt;F&gt; for FieldChip&lt;F&gt; {
    type Num = Number&lt;F&gt;;
    fn load_private(
        &amp;self,
        mut layouter: impl Layouter&lt;F&gt;,
        value: Value&lt;F&gt;,
    ) -&gt; Result&lt;Self::Num, Error&gt; {
        let config = self.config();

        layouter.assign_region(
            || "load private",
            |mut region| {
                region
                    .assign_advice(|| "private input", config.advice[0], 0, || value)
                    .map(Number)
            },
        )
    }

    fn load_constant(
        &amp;self,
        mut layouter: impl Layouter&lt;F&gt;,
        constant: F,
    ) -&gt; Result&lt;Self::Num, Error&gt; {
        let config = self.config();

        layouter.assign_region(
            || "load constant",
            |mut region| {
                region
                    .assign_advice_from_constant(|| "constant value", config.advice[0], 0, constant)
                    .map(Number)
            },
        )
    }

	fn mul(
		&amp;self,
		mut layouter: impl Layouter&lt;F&gt;,
		a: Self::Num,
		b: Self::Num,
	) -&gt; Result&lt;Self::Num, Error&gt; {
		let config = self.config();

		layouter.assign_region(
			|| "mul",
			|mut region: Region&lt;'_, F&gt;| {
				// We only want to use a single multiplication gate in this region,
				// so we enable it at region offset 0; this means it will constrain
				// cells at offsets 0 and 1.
				config.s_mul.enable(&amp;mut region, 0)?;

				// The inputs we've been given could be located anywhere in the circuit,
				// but we can only rely on relative offsets inside this region. So we
				// assign new cells inside the region and constrain them to have the
				// same values as the inputs.
				a.0.copy_advice(|| "lhs", &amp;mut region, config.advice[0], 0)?;
				b.0.copy_advice(|| "rhs", &amp;mut region, config.advice[1], 0)?;

				// Now we can assign the multiplication result, which is to be assigned
				// into the output position.
				let value = a.0.value().copied() * b.0.value();

				// Finally, we do the assignment to the output, returning a
				// variable to be used in another part of the circuit.
				region
					.assign_advice(|| "lhs * rhs", config.advice[0], 1, || value)
					.map(Number)
			},
		)
	}
<span class="boring">}</span></code></pre></pre>
<h4 id="build-the-circuit"><a class="header" href="#build-the-circuit"><a href="https://trapdoor-tech.github.io/halo2-book-chinese/user/simple-example.html#%E6%9E%84%E9%80%A0%E7%94%B5%E8%B7%AF">Build the Circuit</a></a></h4>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†æ‰€éœ€è¦çš„æŒ‡ä»¤ï¼Œä»¥åŠä¸€å—å®ç°äº†è¿™äº›æŒ‡ä»¤çš„èŠ¯ç‰‡ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æ„é€ ç¤ºä¾‹ç”µè·¯å•¦</p>
<p>The <strong>circuit</strong> trait is the entrance to the circuit development. We need to define our own circuit structure and access the <em>witness</em> input.</p>
<p>struct <code>MyCircuit</code> :</p>
<ul>
<li>åœ¨è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œæˆ‘ä»¬ä¿å­˜éšç§è¾“å…¥å˜é‡ã€‚æˆ‘ä»¬ä½¿ç”¨  <code>Option&lt;F&gt;</code> ç±»å‹æ˜¯å› ä¸ºï¼Œåœ¨ç”Ÿæˆå¯†é’¥é˜¶æ®µï¼Œä»–ä»¬ä¸éœ€è¦æœ‰ä»»ä½•çš„å€¼ã€‚åœ¨è¯æ˜é˜¶æ®µä¸­ï¼Œå¦‚æœå®ƒä»¬ä»»ä¸€ä¸º <code>None</code> çš„è¯ï¼Œå°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚</li>
</ul>
<p>The interfaces defined before are all used here.Â <em>configure</em>Â creates a storage column for advice/instance/constant.Â <em>synthesize</em>Â uses a custom chip to get the input witness and constant, and finally, calculate the result and return the public input.</p>
<p>In fact, it can satisfy most scenarios by simply implementing theÂ <em>circuit</em>Â trait for general circuit development. Some common functions of the chip have already been implemented in Halo 2.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct MyCircuit&lt;F: FieldExt&gt; {
    constant: F,
    a: Option&lt;F&gt;,
    b: Option&lt;F&gt;,
}

impl&lt;F: FieldExt&gt; Circuit&lt;F&gt; for MyCircuit&lt;F&gt; {
    // å› ä¸ºæˆ‘ä»¬åœ¨ä»»ä¸€åœ°æ–¹å€¼ç”¨äº†ä¸€ä¸ªèŠ¯ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡ç”¨å®ƒçš„é…ç½®ã€‚
    type Config = FieldConfig;
    type FloorPlanner = SimpleFloorPlanner;

    fn without_witnesses(&amp;self) -&gt; Self {
        Self::default()
    }

    fn configure(meta: &amp;mut ConstraintSystem&lt;F&gt;) -&gt; Self::Config {
        // æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ª advice åˆ—ï¼Œä½œä¸º FieldChip çš„è¾“å…¥ã€‚
        let advice = [meta.advice_column(), meta.advice_column()];

        // æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª instance åˆ—æ¥å­˜å‚¨å…¬å¼€è¾“å…¥ã€‚
        let instance = meta.instance_column();

        // åˆ›å»ºä¸€ä¸ª fixed åˆ—æ¥åŠ è½½å¸¸æ•°
        let constant = meta.fixed_column();

        FieldChip::configure(meta, advice, instance, constant)
    }
    // Prove a2â‹…b2 = c
    fn synthesize(
        &amp;self,
        config: Self::Config,
        mut layouter: impl Layouter&lt;F&gt;,
    ) -&gt; Result&lt;(), Error&gt; {
        let field_chip = FieldChip::&lt;F&gt;::construct(config);

        // å°†æˆ‘ä»¬çš„éšç§å€¼åŠ è½½åˆ°ç”µè·¯ä¸­ã€‚
        let a = field_chip.load_private(layouter.namespace(|| "load a"), self.a)?;
        let b = field_chip.load_private(layouter.namespace(|| "load b"), self.b)?;

        // å°†å¸¸æ•°å› å­åŠ è½½åˆ°ç”µè·¯ä¸­
        let constant =
            field_chip.load_constant(layouter.namespace(|| "load constant"), self.constant)?;

        // æˆ‘ä»¬ä»…æœ‰ä¹˜æ³•å¯ç”¨ï¼Œå› æ­¤æˆ‘ä»¬æŒ‰ä»¥ä¸‹æ–¹æ³•å®ç°ç”µè·¯ï¼š
        //     asq  = a*a
        //     bsq  = b*b
        //     absq = asq*bsq
        //     c    = constant*asq*bsq
        //
        // ä½†æ˜¯ï¼ŒæŒ‰ä¸‹é¢çš„æ–¹æ³•å®ç°ï¼Œæ›´åŠ é«˜æ•ˆ:
        //     ab   = a*b
        //     absq = ab^2
        //     c    = constant*absq
        let ab = field_chip.mul(layouter.namespace(|| "a * b"), a, b)?;
        let absq = field_chip.mul(layouter.namespace(|| "ab * ab"), ab.clone(), ab)?;
        let c = field_chip.mul(layouter.namespace(|| "constant * absq"), constant, absq)?;

        // å°†ç»“æœä½œä¸ºç”µè·¯çš„å…¬å¼€è¾“å…¥è¿›è¡Œå…¬å¼€
        field_chip.expose_public(layouter.namespace(|| "expose c"), c, 0)
    }
} }
<span class="boring">}</span></code></pre></pre>
<h4 id="testing-the-circuit"><a class="header" href="#testing-the-circuit"><a href="https://zcash.github.io/halo2/user/simple-example.html#testing-the-circuit">Testing the circuit</a></a></h4>
<p>TheÂ <em>MockProver</em>Â andÂ <em>CircuitLayout</em>Â that we mentioned in the chapter about tools can come in handy (æ´¾ä¸Šç”¨åœº).</p>
<p>å¯ä»¥ç”¨Â <code>halo2::dev::MockProver</code>Â æ¥æµ‹è¯•ä¸€ä¸ªç”µè·¯æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚æ„é€ ç”µè·¯çš„ä¸€ç»„ Private/Public input ï¼Œè¿™ç»„è¾“å…¥å¯ç›´æ¥ç”¨æ¥è®¡ç®—åˆæ³•è¯æ˜ï¼Œä½†æˆ‘ä»¬æŠŠè¿™ç»„è¾“å…¥ä¼ å…¥åˆ° <code>MockProver::run</code> å‡½æ•°ä¸­ä¹‹åï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªå¯ç”¨äºæ£€éªŒç”µè·¯ä¸­æ¯ä¸€æ¡çº¦æŸæ˜¯å¦æ»¡è¶³çš„å¯¹è±¡ã€‚è€Œä¸”ç”µè·¯éªŒè¯ä¸è¿‡ï¼Œè¿™ä¸ªå¯¹è±¡è¿˜èƒ½è¾“å‡ºé‚£æ¡ä¸æ»¡è¶³çš„çº¦æŸ</p>
<p>å¦‚ä¸‹ä»£ç  , <code>MockProver::run</code>  ä¸­åªçŸ¥é“ Public input <code>c</code> , ä»–å¹¶ä¸çŸ¥é“ Private æ˜¯ä»€ä¹ˆ, ä½†ä»å¯ä»¥è¿›è¡ŒéªŒè¯</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    // æˆ‘ä»¬ç”µè·¯çš„è¡Œæ•°ä¸èƒ½è¶…è¿‡ 2^k. å› ä¸ºæˆ‘ä»¬çš„ç¤ºä¾‹ç”µè·¯å¾ˆå°ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªè¾ƒå°çš„å€¼
    let k = 4;

    // å‡†å¤‡å¥½ç”µè·¯çš„éšç§è¾“å…¥å’Œå…¬å¼€è¾“å…¥
    let constant = Fp::from(7);
    let a = Fp::from(2);
    let b = Fp::from(3);
    let c = constant * a.square() * b.square();  // ç®—å‡ºæ¥

    // ç”¨éšç§è¾“å…¥æ¥å®ä¾‹åŒ–ç”µè·¯
    let circuit = MyCircuit {
        constant,
        a: Value::known(a),
        b: Value::known(b),
    };

    // å°†å…¬å¼€è¾“å…¥è¿›è¡Œæ’åˆ—ã€‚ä¹˜æ³•çš„ç»“æœè¢«æˆ‘ä»¬æ”¾ç½®åœ¨ instance åˆ—çš„ç¬¬0è¡Œï¼Œ
    // æ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨å…¬å¼€è¾“å…¥çš„å¯¹åº”ä½ç½®ã€‚
    let mut public_inputs = vec![c];

    // ç»™å®šæ­£ç¡®çš„å…¬å¼€è¾“å…¥ï¼Œæˆ‘ä»¬çš„ç”µè·¯èƒ½éªŒè¯é€šè¿‡
    let prover = MockProver::run(k, &amp;circuit, vec![public_inputs.clone()]).unwrap();
    assert_eq!(prover.verify(), Ok(()));

    // å¦‚æœæˆ‘ä»¬å°è¯•ç”¨å…¶ä»–çš„å…¬å¼€è¾“å…¥(æ­¤å¤„æ˜¯ +1)ï¼Œè¯æ˜å°†å¤±è´¥ï¼
    public_inputs[0] += Fp::one();
    let prover = MockProver::run(k, &amp;circuit, vec![public_inputs]).unwrap();
    assert!(prover.verify().is_err());
}</code></pre></pre>
<h3 id="code-ref--full-example-1"><a class="header" href="#code-ref--full-example-1">Code Ref / <a href="https://zcash.github.io/halo2/user/simple-example.html#full-example">Full example</a></a></h3>
<p>You can find the source code for this exampleÂ <a href="https://github.com/zcash/halo2/tree/main/halo2_proofs/examples/simple-example.rs">here</a>.</p>
<pre><code class="language-bash">cargo run --example simple-example
</code></pre>
<h3 id="-é—®é¢˜-question-"><a class="header" href="#-é—®é¢˜-question-">â€”â€“ é—®é¢˜ Question â€”â€“</a></h3>
<ol>
<li></li>
</ol>
<p>è¿™æ„å‘³ç€å®ƒå°†å¯¹ offsets 0 and 1 å¤„çš„ 2 ä¸ª cells éƒ½è¿›è¡Œçº¦æŸ(ä¸ºå•¥ï¼Ÿ)</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>config.s_mul.enable(&amp;mut region, 0)?;
<span class="boring">}</span></code></pre></pre>
<ol start="2">
<li></li>
</ol>
<p>å¥‡æ€ªçš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨ <code>fn mul() </code>å‡½æ•°ä¸­ï¼Œæ—¢ç„¶å·²ç»ä½¿ç”¨äº†å‚æ•° a: Self::Num, b: Self::Num, è®¾ç½®äº† lhs Cell å’Œ rhs Cellï¼Œé‚£ä¹ˆ a.cell å’Œ lhsã€ b.cell å’Œ rhs è‚¯å®šå°±æ˜¯ç›¸ç­‰çš„ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å† region.constrain_equal çº¦æŸä¸€æ¬¡å‘¢ï¼Ÿè¿™ä¸ªçº¦æŸçœ‹èµ·æ¥æ˜¯å¤šä½™çš„ä¸”æ²¡æœ‰å¿…è¦çš„ï¼Ÿ</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// åœ¨æ­¤ region ä¸­ï¼Œæˆ‘ä»¬åªæƒ³ç”¨ä¸€ä¸ªä¹˜æ³•é—¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ region offset=0 å¤„æ¿€æ´»å®ƒï¼›
// è¿™æ„å‘³ç€å®ƒå°†å¯¹ offsets 0 and 1 å¤„çš„ 2 ä¸ª cells éƒ½è¿›è¡Œçº¦æŸ(ä¸ºå•¥ï¼Ÿ)
config.s_mul.enable(&amp;mut region, 0)?;

// ç»™æˆ‘ä»¬çš„è¾“å…¥æœ‰å¯èƒ½åœ¨ç”µè·¯çš„ä»»ä¸€ä½ç½®ï¼Œä½†åœ¨å½“å‰ region ä¸­ï¼Œæˆ‘ä»¬ä»…å¯ä»¥ç”¨
// ç›¸å¯¹åç§»ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ region å†…åˆ†é…æ–°çš„ cells å¹¶é™å®šä»–ä»¬çš„å€¼ä¸è¾“å…¥ cells çš„å€¼ç›¸ç­‰ã€‚
let lhs = region.assign_advice(
	|| "lhs",
	config.advice[0], // ç¬¬ 0 åˆ— (advice åˆ—)
	0,                // ç¬¬ 0 è¡Œ
	|| a.value.ok_or(Error::SynthesisError), // æ”¾ a çš„å€¼è¿›å»
)?;
let rhs = region.assign_advice(
	|| "rhs",
	config.advice[1], // ç¬¬ 1 åˆ—,
	0,                // ç¬¬ 0 è¡Œ
	|| b.value.ok_or(Error::SynthesisError),
)?;
region.constrain_equal(a.cell, lhs)?;
region.constrain_equal(b.cell, rhs)?;
<span class="boring">}</span></code></pre></pre>
<p>GPTï¼š</p>
<blockquote>
<p>è™½ç„¶ <code>lhs</code> å’Œ <code>rhs</code> çš„å€¼è¢«è®¾ç½®ä¸º <code>a.value</code> å’Œ <code>b.value</code>ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬åœ¨ç”µè·¯ä¸­æ˜¯ç›¸ç­‰çš„ã€‚åœ¨ç”µè·¯çš„å¸ƒå±€ä¸­ï¼Œ<code>a.cell</code> å’Œ <code>b.cell</code> å¯èƒ½å·²ç»åœ¨å…¶ä»–ä½ç½®è¢«ï¼ˆæ„å¤–åœ°ï¼‰èµ‹å€¼å’Œçº¦æŸè¿‡äº†ã€‚è€Œåœ¨è¿™ä¸ªæ–°çš„åŒºåŸŸï¼ˆregionï¼‰ä¸­ï¼Œä¸ºäº†è¿›è¡Œä¹˜æ³•æ“ä½œï¼Œä½ éœ€è¦ç¡®ä¿æ–°åˆ†é…çš„ <code>lhs</code> å’Œ <code>rhs</code> cells ä¸åŸå§‹çš„ <code>a.cell</code> å’Œ <code>b.cell</code> ç›¸ç­‰</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>region.constrain_equal</code> æ˜¯å¿…è¦çš„ï¼šå®ƒç¡®ä¿äº†åœ¨è¿™ä¸ªåŒºåŸŸï¼ˆregionï¼‰ä¸­çš„è®¡ç®—ä½¿ç”¨äº†æ­£ç¡®çš„è¾“å…¥å€¼</p>
<p>ä½ å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªå®‰å…¨æ€§ä¿éšœã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªçº¦æŸï¼Œæœ‰å¯èƒ½ä¼šæœ‰å…¶ä»–çš„å€¼è¿›å…¥è¿™ä¸ªåŒºåŸŸï¼Œå¹¶å¯èƒ½å¯¼è‡´ç”µè·¯ç”Ÿæˆé”™è¯¯çš„ç»“æœã€‚é€šè¿‡åŠ å…¥è¿™ä¸ªçº¦æŸï¼Œä½ ç¡®ä¿äº†ä¹˜æ³•æ“ä½œæ˜¯åœ¨æ­£ç¡®çš„å€¼ä¸Šè¿›è¡Œçš„ã€‚</p>
</blockquote>
<p>ç›®å‰çš„ halo2_proofsï¼Œä¸€èˆ¬ç›´æ¥ä½¿ç”¨ <code>copy_advice</code>ï¼š</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span><span class="boring">}</span></code></pre></pre>
<footer id="open-on-gh">Found a bug?! <a href="https://github.com/zkp-co-learning/zkp-co-learning.github.io/edit/main/src/halo2/tmp/1-Simple-Example.md">Edit this page on GitHub.</a></footer>
                        <hr>
                        <div class="giscus"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../halo2/tmp/halo2-learning-materials.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../halo2/tmp/2-Fibonacci-example-1.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../halo2/tmp/halo2-learning-materials.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../halo2/tmp/2-Fibonacci-example-1.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/mermaid.min.js"></script>
        <script src="../../theme/mermaid-init.js"></script>


    </div>

    <script type="text/javascript">
        var langs = [
            'cn',
            'en',
        ];

        (function initLangs() {
            var html = document.querySelector('html');
            var langToggleButton = document.getElementById('lang-toggle');
            var langPopup = document.getElementById('lang-list');

            function showLangs() {
                langPopup.style.display = 'block';
                langToggleButton.setAttribute('aria-expanded', true);
            }

            function hideLangs() {
                langPopup.style.display = 'none';
                langToggleButton.setAttribute('aria-expanded', false);
                langToggleButton.focus();
            }

            langToggleButton.addEventListener('click', function () {
                if (langPopup.style.display === 'block') {
                    hideLangs();
                } else {
                    showLangs();
                }
            });

            langPopup.addEventListener('focusout', function(e) {
                // e.relatedTarget is null in Safari and Firefox on macOS (see workaround below)
                if (!!e.relatedTarget && !langToggleButton.contains(e.relatedTarget) && !langPopup.contains(e.relatedTarget)) {
                    hideLangs();
                }
            });

            // Should not be needed, but it works around an issue on macOS & iOS: https://github.com/rust-lang-nursery/mdBook/issues/628
            document.addEventListener('click', function(e) {
                if (langPopup.style.display === 'block' && !langToggleButton.contains(e.target) && !langPopup.contains(e.target)) {
                    hideLangs();
                }
            });

            // For each language, update the link to point to the current page in that language
            let linkParts = window.location.pathname.split('/');
            let langIndex = linkParts.findIndex((s) => langs.includes(s));
            langs.forEach(function (lang) {
                var link = document.getElementById('lang-' + lang);
                if (!link) {
                    return;
                }

                let newLinkParts = linkParts.slice();

                // If it is Chinese, remove the current language from the path
                if (lang === "cn") {
                    if (langIndex !== -1) {
                        newLinkParts.splice(langIndex, 1);
                    }
                }
                
                // Otherwise, add the new language to the path
                else {
                    if (langIndex === -1) {
                        // Modify this line to insert the language right after the domain
                        newLinkParts.splice(1, 0, lang);
                    } else {
                        newLinkParts[langIndex] = lang;
                    }
                }

                link.href = newLinkParts.join('/');
            });
        })();

        </script>
        <script src="https://giscus.app/client.js"
                data-repo="zkp-co-learning/zkp-co-learning.github.io"
                data-repo-id="R_kgDOKNpxMQ"
                data-category="Announcements"
                data-category-id="DIC_kwDOKNpxMc4CZ2LA"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="light"
                data-lang="zh-CN"
                crossorigin="anonymous"
                async>
        </script>
    </body>
</html>
